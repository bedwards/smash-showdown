# Faultline Fear: 3D Asset Workflow

This document describes the complete workflow for getting Blender 3D assets into the Roblox game while maintaining Rojo source control.

## Overview

The challenge: Rojo manages code as source files, but imported 3D assets (FBX) exist only in Roblox Studio. When you run `rojo build`, it creates a fresh place file WITHOUT your imported assets.

**Solution**: Import in Studio, save place file, use Lune to extract models as `.rbxm` files.

## Complete Workflow (3 Human Clicks)

```
┌─────────────────────────────────────────────────────────────┐
│  STEP 1: Generate Combined FBX (Automated - Claude runs)   │
│  $ blender --background --python tools/blender/combine_all_fbx.py
│  Output: assets/faultline-fear/meshes/combined_all_assets.fbx
└─────────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────┐
│  STEP 2: Import FBX in Roblox Studio (Human - 1 click)     │
│  File → Import 3D → Select combined_all_assets.fbx         │
└─────────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────┐
│  STEP 3: Move to Storage (Human - 1 click)                 │
│  Click "Move to Storage" plugin button                      │
│  Assets move to ServerStorage.AssetTemplates               │
└─────────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────┐
│  STEP 4: Save Place File (Human - 1 click)                 │
│  File → Save to File As → faultline-fear-with-assets.rbxl  │
└─────────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────┐
│  STEP 5: Extract Models (Automated - Claude runs)          │
│  $ lune run tools/extract-models-from-place.luau           │
│  Reads place file, extracts each model as .rbxm            │
└─────────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────┐
│  STEP 6: Update Project Config (Automated - Claude runs)   │
│  $ lune run tools/update-asset-paths.luau                   │
│  Updates faultline-fear.project.json to reference .rbxm    │
└─────────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────┐
│  STEP 7: Test & Publish (Automated - Claude runs)          │
│  $ rojo build ... && run-in-roblox ...                     │
│  Now builds include the 3D assets!                          │
└─────────────────────────────────────────────────────────────┘
```

## Human Steps Summary

Only **3 clicks** in Roblox Studio:

1. **File → Import 3D** → Select `combined_all_assets.fbx`
2. **Click "Move to Storage"** plugin button
3. **File → Save to File As** → `faultline-fear-with-assets.rbxl`

Everything else is automated by Claude.

## File Locations

```
assets/faultline-fear/
├── meshes/
│   └── combined_all_assets.fbx    # Generated by Blender (NOT in git)
├── rbxm/                          # RBXM exports (IN git)
│   ├── Structures_FerrisWheel.rbxm
│   ├── Structures_Lighthouse.rbxm
│   ├── Structures_Bridge.rbxm
│   ├── Structures_RadioTower.rbxm
│   ├── Structures_WaterTower.rbxm
│   └── ...
└── blender/
    └── *.blend                    # Source Blender files
```

## Project Configuration

The project.json references .rbxm files like this:

```json
{
  "ServerStorage": {
    "$className": "ServerStorage",
    "AssetTemplates": {
      "$className": "Folder",
      "Structures_FerrisWheel": {
        "$path": "assets/faultline-fear/rbxm/Structures_FerrisWheel.rbxm"
      },
      "Structures_Lighthouse": {
        "$path": "assets/faultline-fear/rbxm/Structures_Lighthouse.rbxm"
      }
    }
  }
}
```

## Publishing to Roblox

After the workflow is complete:

```bash
# Build the place with all assets
rojo build faultline-fear.project.json -o faultline-fear.rbxl

# Upload to Roblox
rojo upload faultline-fear.project.json --asset_id YOUR_PLACE_ID
```

Or in Roblox Studio:
1. Open the built .rbxl file
2. File → Publish to Roblox

## Automation Scripts

| Script | Purpose |
|--------|---------|
| `tools/blender/combine_all_fbx.py` | Combines all Blender models into one FBX |
| `tools/update-asset-paths.luau` | Updates project.json with .rbxm references |
| `tools/verify-assets.luau` | Verifies all .rbxm files are present |

## Troubleshooting

### "Assets are gray/no color"
Colors are applied at runtime by `AssetColors.luau`. Ensure:
1. The model name matches a key in `AssetColors.COLORS`
2. `AssetColors:ApplyColors(model, assetName)` is called after spawning

### "Model not found in AssetManifest"
The AssetManifest looks for models in `ServerStorage.AssetTemplates` with names like `Structures_FerrisWheel`. Ensure:
1. The .rbxm file is named correctly
2. The project.json references it under `AssetTemplates`

### "rojo build doesn't include my assets"
1. Check that .rbxm files exist in `assets/faultline-fear/rbxm/`
2. Run `lune run tools/update-asset-paths.luau` to update project.json
3. Verify the project.json has `$path` entries for each asset

## Sources

Workflow based on:
- [Rojo Project Format Documentation](https://rojo.space/docs/v6/project-format/)
- [Rojo Sync Details](https://rojo.space/docs/v6/sync-details/)
- [Asphalt Asset Management](https://github.com/jackTabsCode/asphalt)
- [Partially Managed Rojo Tutorial](https://devforum.roblox.com/t/how-to-automate-place-publishing-with-partially-managed-rojo/2443196)
